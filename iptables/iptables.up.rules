# Generated by iptables-save v1.6.1 on Fri Oct  6 10:08:22 2017
*nat
:PREROUTING ACCEPT [216:26290]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [534:46995]
:POSTROUTING ACCEPT [150:10576]
COMMIT
# Completed on Fri Oct  6 10:08:22 2017
# Generated by iptables-save v1.6.1 on Fri Oct  6 10:08:22 2017
*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT DROP [0:0]
:BLACKLIST - [0:0]
:IN_OTHER_BLACKLIST - [0:0]
:IN_TCP - [0:0]
:IN_TCP_BLACKLIST - [0:0]
:IN_UDP - [0:0]
:IN_UDP_BLACKLIST - [0:0]
:OUT_ICMP - [0:0]
:OUT_TCP - [0:0]
:OUT_UDP - [0:0]
-A INPUT -p icmp -m comment --comment "Mark incoming ICMP echo-request packets. This will be used for logging potential ping floods." -m icmp --icmp-type 8 -m recent --set --name PING_FLOOD --mask 255.255.255.255 --rsource
-A INPUT -p icmp -m comment --comment "Log icmp packets when we have received more than 6 form the same host in less than 4 seconds" -m icmp --icmp-type 8 -m recent --update --seconds 6 --hitcount 4 --name PING_FLOOD --mask 255.255.255.255 --rsource -j LOG --log-prefix "IPTables: Ping Flood: " --log-level 1
-A INPUT -p icmp -m comment --comment "PCAP icmp packets when we have received more than 6 form the same host in less than 4 seconds" -m icmp --icmp-type 8 -m recent --update --seconds 4 --hitcount 6 --name PING_FLOOD --mask 255.255.255.255 --rsource -j NFLOG --nflog-prefix  "IPTables: Ping Flood: " --nflog-group 1
-A INPUT -p icmp -m comment --comment "Drop ICMP packets that have been marked as PING_FLOOD packets." -m icmp --icmp-type 8 -m recent --update --seconds 4 --hitcount 6 --name PING_FLOOD --mask 255.255.255.255 --rsource -j DROP
-A INPUT -p icmp -m comment --comment "DROP incoming ICMP echo-requests from hosts that have not pinged more than 4 time in 6 seconds." -m icmp --icmp-type 8 -j DROP
-A INPUT -m comment --comment "Accept all established connections." -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A INPUT -m comment --comment "Deal with BLACKLIST traffic" -m recent --update --seconds 60 --name BLACKLIST --mask 255.255.255.255 --rsource -j BLACKLIST
-A INPUT -i lo -m comment --comment "Accept all connections coming from lo." -j ACCEPT
-A INPUT -m comment --comment "PCAP all connections that have an invalid state." -m conntrack --ctstate INVALID -j NFLOG --nflog-prefix  "IPTables: Invalid IN: " --nflog-group 1
-A INPUT -m comment --comment "Log all connections that have an invalid state." -m conntrack --ctstate INVALID -j LOG --log-prefix "IPTables: Invalid IN: "
-A INPUT -m comment --comment "Drop all connections that have an invalid state. This will cause some issues with IPv6 ICMP traffic." -m conntrack --ctstate INVALID -j DROP
-A INPUT -p udp -m comment --comment "Send NEW incoming UDP traffic to the IN_UDP chain." -m conntrack --ctstate NEW -j IN_UDP
-A INPUT -p tcp -m comment --comment "Send all NEW TCP SYN connections to the IN_TCP chain." -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m conntrack --ctstate NEW -j IN_TCP
-A INPUT -p udp -m comment --comment "Log all invalid incoming UDP traffic." -j LOG --log-prefix "IPTables: Bad UDP: " --log-level 2 --log-ip-options
-A INPUT -p udp -m comment --comment "PCAP all invalid incoming UDP traffic." -j NFLOG --nflog-prefix  "IPTables: Bad UDP: " --nflog-group 1
-A INPUT -p udp -m comment --comment "Reject all invalid incoming UDP traffic. Mark UDP traffic from this IP as bad. This mark will be used in the IN_UDP chain." -m recent --set --name BLACKLIST --mask 255.255.255.255 --rsource -j DROP
-A INPUT -p tcp -m comment --comment "Log all invalid incoming TCP traffic." -j LOG --log-prefix "IPTables: Bad TCP: " --log-level 2 --log-ip-options
-A INPUT -p tcp -m comment --comment "PCAP all invalid incoming TCP traffic." -j NFLOG --nflog-prefix  "IPTables: Bad TCP: " --nflog-group 1
-A INPUT -p tcp -m comment --comment "Reject invalid incoming TCP traffic. Mark TCP traffic from this IP as bad. This mark will be used in the IN_TCP chain." -m recent --set --name BLACKLIST --mask 255.255.255.255 --rsource -j DROP
-A INPUT -m comment --comment "LOG all invalid incoming traffic that is neither TCP nor UDP." -j LOG --log-prefix "IPTables: Bad ?: " --log-level 2
-A INPUT -m comment --comment "PCAP all invalid incoming traffic that is neither TCP nor UDP." -j NFLOG --nflog-prefix  "IPTables: Bad ?: " --nflog-group 1
-A INPUT -m comment --comment "DROP all invalid incoming traffic that is neither TCP nor UDP." -j DROP
-A FORWARD -p tcp -m comment --comment "Log invalid TCP forward requests." -j LOG --log-prefix "IPTables: Bad Forward TCP: " --log-level 2 --log-tcp-options --log-ip-options
-A FORWARD -p tcp -m comment --comment "PCAP invalid TCP forward requests." -j NFLOG --nflog-prefix  "IPTables: Bad Forward TCP: " --nflog-group 1
-A FORWARD -p tcp -m comment --comment "Drop invalid tcp forward requests." -j DROP
-A FORWARD -p udp -m comment --comment "Log invalid UDP forward requests." -j LOG --log-prefix "IPTables: Bad Forward UDP: " --log-level 2 --log-ip-options
-A FORWARD -p udp -m comment --comment "PCAP invalid UDP forward requests." -j NFLOG --nflog-prefix  "IPTables: Bad Forward UDP: " --nflog-group 1
-A FORWARD -p udp -m comment --comment "Drop invalid UDP forward requests." -j DROP
-A FORWARD -m comment --comment "Log invalid forwards for all other transport protocols." -j LOG --log-prefix "IPTables: Bad Forward ?: " --log-level 2 --log-ip-options
-A FORWARD -m comment --comment "PCAP invalid forwards for all other transport protocols." -j NFLOG --nflog-prefix  "IPTables: Bad Forward ?: " --nflog-group 1
-A FORWARD -m comment --comment "Drop invalid forwards for all other transport protocols." -j DROP
-A OUTPUT -m comment --comment "Accept RELATED/ESTABLISHED connections" -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A OUTPUT -o lo -m comment --comment "Allow loopback" -j ACCEPT
-A OUTPUT -p tcp -j OUT_TCP
-A OUTPUT -p udp -j OUT_UDP
-A OUTPUT -p icmp -j OUT_ICMP
-A OUTPUT -m comment --comment "Log bad output" -j LOG --log-prefix "IPTables: Invalid OUT: " --log-level 5 --log-tcp-options --log-ip-options --log-uid
-A OUTPUT -j REJECT --reject-with icmp-admin-prohibited
-A BLACKLIST -p tcp -m comment --comment "Deal with bad TCP input traffic." -j IN_TCP_BLACKLIST
-A BLACKLIST -p udp -m comment --comment "Deal with bad UDP input traffic." -j IN_UDP_BLACKLIST
-A BLACKLIST -m comment --comment "Deal with bad other input traffic." -j IN_OTHER_BLACKLIST
-A BLACKLIST -m comment --comment "Drop everything on the floor." -j DROP
-A IN_OTHER_BLACKLIST -m comment --comment "PCAP blacklisted other traffic." -j NFLOG --nflog-prefix  "IPTables: Bad Other IN: " --nflog-group 1
-A IN_OTHER_BLACKLIST -m comment --comment "LOG blacklisted other traffic." -j LOG --log-prefix "IPTables: Bad Other IN: " --log-level 5 --log-tcp-options --log-ip-options --log-uid
-A IN_OTHER_BLACKLIST -m comment --comment "Drop all bad packets" -j DROP
-A IN_TCP -m comment --comment "Deal with blacklisted traffic." -m recent --update --seconds 60 --name TCP-PORTSCAN --mask 255.255.255.255 --rsource -j IN_TCP_BLACKLIST
-A IN_TCP -p tcp -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m tcp --dport 22 -m conntrack --ctstate NEW -m comment --comment "Allow SSH" -j ACCEPT
-A IN_TCP -p tcp -m tcp --dport 5353 -m comment --comment "Allow LLMR" -j ACCEPT
-A IN_TCP_BLACKLIST -m comment --comment "PCAP blacklisted incoming TCP traffic." -j NFLOG --nflog-prefix  "IPTables: Bad TCP IN: " --nflog-group 1
-A IN_TCP_BLACKLIST -m comment --comment "Drop all bad packets" -j DROP
-A IN_UDP -m comment --comment "Deal with blacklisted traffic." -m recent --update --seconds 60 --name UPD-PORTSCAN --mask 255.255.255.255 --rsource -j IN_UDP_BLACKLIST
-A IN_UDP -p udp -m udp --dport 137 -m comment --comment "Allow NetBIOS name resolution." -j ACCEPT
-A IN_UDP -p udp -m udp --dport 5353 -m comment --comment "Allow mDNS" -j ACCEPT
-A IN_UDP_BLACKLIST -m comment --comment "PCAP blacklisted incoming UDP traffic." -j NFLOG --nflog-prefix  "IPTables: Bad UDP IN: " --nflog-group 1
-A IN_UDP_BLACKLIST -m comment --comment "Drop all bad packets" -j DROP
-A OUT_ICMP -p icmp -m comment --comment "Allow out going echo-request packets" -m icmp --icmp-type 8 -m conntrack --ctstate NEW -j ACCEPT
-A OUT_TCP -p tcp -m comment --comment "Allow HTTP" -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m tcp --dport 80 -m conntrack --ctstate NEW -j ACCEPT
-A OUT_TCP -p tcp -m comment --comment "Allow HTTPS" -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m tcp --dport 443 -m conntrack --ctstate NEW -j ACCEPT
-A OUT_TCP -p tcp -m comment --comment "Allow SSH" -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m tcp --dport 22 -m conntrack --ctstate NEW -j ACCEPT
-A OUT_TCP -p tcp -m comment --comment "Allow DNS" -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m tcp --dport 53 -m conntrack --ctstate NEW -j ACCEPT
-A OUT_TCP -p tcp -m comment --comment "Allow git protocol" -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m tcp --dport 9418 -m conntrack --ctstate NEW -j ACCEPT
-A OUT_TCP -p tcp -m comment --comment "Allow GPG" -m tcp --tcp-flags FIN,SYN,RST,ACK SYN -m tcp --dport 11371 -m conntrack --ctstate NEW -j ACCEPT
-A OUT_UDP -p udp -m comment --comment "Allow DNS" -m udp --dport 53 -m conntrack --ctstate NEW -j ACCEPT
-A OUT_UDP -p udp -m udp --dport 137 -m comment --comment "Allow NetBIOS name resolution." -j ACCEPT
-A OUT_UDP -p udp -m udp --dport 5353 -m comment --comment "Allow mDNS" -j ACCEPT
COMMIT
# Completed on Fri Oct  6 10:08:22 2017
